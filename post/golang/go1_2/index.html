<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Go1.2新功能简介 - chai2010 的博客</title>
  <link rel="alternate" hreflang="zh-CN" href="https://chai2010.cn/" />

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="chai2010" />
  <meta name="description" content="距离2013.08.12正式发布Go1.1.2大约1个月了. 目前Go语言已经进入Go1.2的发布流程, 预计将在2013年底发布. 本文主要列举" />

  <meta name="keywords" content="chai2010, Go, Golang" />






<meta name="generator" content="Hugo 0.30.2" />


<link rel="canonical" href="https://chai2010.cn/post/golang/go1_2/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico" />
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">


<meta property="og:title" content="Go1.2新功能简介" />
<meta property="og:description" content="距离2013.08.12正式发布Go1.1.2大约1个月了. 目前Go语言已经进入Go1.2的发布流程, 预计将在2013年底发布. 本文主要列举" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chai2010.cn/post/golang/go1_2/" />



<meta property="article:published_time" content="2013-09-09T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2013-09-09T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Go1.2新功能简介">
<meta itemprop="description" content="距离2013.08.12正式发布Go1.1.2大约1个月了. 目前Go语言已经进入Go1.2的发布流程, 预计将在2013年底发布. 本文主要列举">


<meta itemprop="datePublished" content="2013-09-09T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2013-09-09T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1370">



<meta itemprop="keywords" content="golang," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Go1.2新功能简介"/>
<meta name="twitter:description" content="距离2013.08.12正式发布Go1.1.2大约1个月了. 目前Go语言已经进入Go1.2的发布流程, 预计将在2013年底发布. 本文主要列举"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-621845-14', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">chai2010 的博客</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">全部文章</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/talks/">
        <li class="mobile-menu-item">报告</li>
      </a><a href="/books/">
        <li class="mobile-menu-item">图书</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">chai2010 的博客</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">全部文章</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/talks/">报告</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/books/">图书</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Go1.2新功能简介</h1>

      <div class="post-meta">
        <span class="post-time"> 2013-09-09 </span>
        <div class="post-category">
            
              <a href="/categories/golang/"> golang </a>
            
          </div>
        <span class="more-meta"> 约 1370 字 </span>
        <span class="more-meta"> 预计阅读 3 分钟 </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#语言的改变">语言的改变</a>
<ul>
<li><a href="#禁止nil对象取值">禁止nil对象取值</a></li>
<li><a href="#切片语法增加cap域">切片语法增加cap域</a></li>
<li><a href="#cgo支持c-源码">cgo支持C++源码</a></li>
<li><a href="#runtime实现的变化">runtime实现的变化</a></li>
<li><a href="#关于动态库支持">关于动态库支持</a></li>
<li><a href="#gccgo的状态">gccgo的状态</a></li>
</ul></li>
<li><a href="#性能优化">性能优化</a></li>
<li><a href="#标准库的变化">标准库的变化</a></li>
<li><a href="#杂项消息-个人补充">杂项消息(个人补充)</a></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<!-- Go1.2有哪些改进? -->

<p>距离2013.08.12正式发布Go1.1.2大约1个月了.
目前Go语言已经进入Go1.2的发布流程, 预计将在2013年底发布.</p>

<p>本文主要列举Go1.2的一些大的改进, 并会持续保持更新.</p>

<h1 id="语言的改变">语言的改变</h1>

<h2 id="禁止nil对象取值">禁止nil对象取值</h2>

<p>对于Go1.0, 有以下代码:</p>

<pre><code>type T struct {
    X [1&lt;&lt;24]byte
    Field int32
}

func main() {
    var x *T
}
</code></pre>

<p>操作 <code>x.Field</code> 将会对应到 <code>1&lt;&lt;24</code> 位置的内存.
在Go1.2中, 将导致 <code>panic</code> 或 错误.</p>

<h2 id="切片语法增加cap域">切片语法增加cap域</h2>

<p>之前在切片时, cap默认为最大.
比如:</p>

<pre><code>var array [10]int
slice := array[2:4]
</code></pre>

<p><code>slice</code>的容量是8. 在Go1.2中, 如希望容量为6, 可以这样:</p>

<pre><code>slice = array[2:4:6]
</code></pre>

<p>如果第一部分的开始地址省略, 则默认为0.</p>

<p>有了可定制的cap语法，就可以自己new一个大内存，然后自己构造malloc/free内存管理函数了。</p>

<p>每次malloc返回的slice的cap被严格限定为申请的size。</p>

<p>该语法的设计文档： <a href="https://docs.google.com/document/d/1GKKdiGYAghXRxC2BFrSEbHBZZgAGKQ-yXK-hRKBo0Kk/pub">https://docs.google.com/document/d/1GKKdiGYAghXRxC2BFrSEbHBZZgAGKQ-yXK-hRKBo0Kk/pub</a></p>

<h2 id="cgo支持c-源码">cgo支持C++源码</h2>

<p>CGO支持函数指针, 用法请参考 <a href="https://code.google.com/p/go/source/browse/misc/cgo/test/fpvar.go">https://code.google.com/p/go/source/browse/misc/cgo/test/fpvar.go</a>.</p>

<p>CGO支持C++语法, 但是只支持C语言的导入符号.</p>

<p>针对C++增加了 <code>CPPFLAGS</code> 和 <code>CXXFLAGS</code> 参数设置选项.</p>

<p>比较适合用C语言导出, 但是用C++实现的库.</p>

<p><strong>注: windows版本的MinGW还不支持外部链接, 详情请参考 <a href="https://code.google.com/p/go/issues/detail?id=6533">Issue6533</a>.</strong></p>

<h2 id="runtime实现的变化">runtime实现的变化</h2>

<p>goroutines 的函数入口采用抢占式调度.</p>

<p>在之前的版本中, 如果goroutines内部有死循环,
那么其他的 goroutines 可能无法获取此线程的CPU资源,
特别是在 GOMAXPROCS 设置为 1 个线程的时候.</p>

<p>在Go1.2中部分解决了此问题: 调度器会在函数的
入口处被偶尔触发. 也就是说, 如果任何循环
内部调用了一个非内联的函数的话, 其他goroutines
也将有机会在同一个线程执行.</p>

<p>在Go1.2, goroutine 的默认堆栈大小临时由4KB改为8KB.
新改的8KB大小对于很多实际的程序可以带来一定的性能提升.
当然, 更大的默认堆栈也导致了程序可能使用更多的内存,
在后续的Go开发中采用更好的堆栈技术解决这个问题.</p>

<p>同时goroutine的栈有最大限制(不是无限的), 64位系统默认限制为1GB,
32位系统模型限制为250MB.
如果需要调整默认值, 可以调用 <code>runtime/debug</code> 包的 <code>SetMaxStack</code> 函数修改.
具体请参考: <a href="https://codereview.appspot.com/12541052">CL12541052</a></p>

<p>程序开启的系统线程有增加了最大数量限制(默认为10000).
如果需要调整默认值, 可以调用 <code>runtime/debug</code> 包的 <code>SetMaxThreads</code> 函数修改.
具体请参考: <a href="https://codereview.appspot.com/13037043">CL13037043</a></p>

<h2 id="关于动态库支持">关于动态库支持</h2>

<p>Linux/Arm 版本已经支持外部链接.
这是Go的编译工具链支持动态库特性的一个关键环节.</p>

<h2 id="gccgo的状态">gccgo的状态</h2>

<p>期望GCC4.9能包含完整的Go1.2. 目前的GCC4.8.2包含Go1.1.2.</p>

<h1 id="性能优化">性能优化</h1>

<ul>
<li>compress/bzip2: 30%的性能提升</li>
<li>crypto/des: 5倍的性能提升</li>
<li>encoding/json: encoding 30% 的性能提升</li>
<li>net: windows/BSD下 网络和 <code>runtime</code> 的深度集成(Linux/OS X在Go1.1已经支持), 30% 的性能提升</li>
</ul>

<h1 id="标准库的变化">标准库的变化</h1>

<p>较大的变化有:</p>

<ul>
<li>encoding: 新包, 提供通用的 <code>encoding</code> 接口</li>
<li>fmt: 引入参数索引支持, 主要是处理不同语言翻译之后参数顺序的变化</li>
<li>sync/atomic: 增加了 <code>Swap</code> 函数</li>
<li>text/template: 增加 <code>eq</code>/<code>lt</code> 等比较函数, 增加 <code>{{else if ... }}</code>简化语法</li>
<li>runtime: 简化 <code>SetFinalizer</code> 参数 <code>f</code> 的参数类型的限制, 只要可赋值即可</li>
<li>testing: 增加的 <code>TB</code> 接口</li>
<li><code>image/gif</code> 增加了 <code>encode</code> 函数</li>
<li>MD5/HASH等增加便利的函数</li>
</ul>

<p>fmt新支持的参数索引:</p>

<pre><code>fmt.Printf(&quot;%[3]c %[1]c %[1]c %c\n&quot;, 'a', 'b', 'c')
// output: c a a b
</code></pre>

<p>简化的HASH用法：</p>

<pre><code>hash := sha1.Sum([]byte(&quot;123&quot;))
fmt.Printf(&quot;H(data) = %x\n&quot;, hash)
</code></pre>

<h1 id="杂项消息-个人补充">杂项消息(个人补充)</h1>

<ul>
<li>go 命令行工具迁移到 <code>go.tools</code>, 并将大幅改进版面</li>
<li><code>go.text/encoding</code> 增加了 GBK 的支持, 彻底解决中文Windows命令行中文乱码问题.</li>
<li><code>go.image</code> 增加了 bmp 的保存 和 分块 tiff 的读取支持, 目前还不支持超大tiff图像.</li>
<li>notepad++ 更好的高亮显示, builtin函数的自动补全, 函数/方法列表等功能.</li>
</ul>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">chai2010</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2013-09-09</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/golang/">golang</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/golang/go-passed-by-value/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Go语言的传参和传引用</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/misc/tiff-spec/">
            <span class="next-text nav-default">TIFF6.0格式简介</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>

    <script src="https://giscus.app/client.js"
    data-repo="chai2010/chai2010.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxMjQxNjY5MDk="
    data-category="General"
    data-category-id="DIC_kwDOB2ai_c4CR3mk"
    data-mapping="og:title"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="light"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
  </script>
  </article>
        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  

  <span class="copyright-year">
    &copy;
    
      2006 -
    2022
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">chai2010</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>


</body>
</html>
